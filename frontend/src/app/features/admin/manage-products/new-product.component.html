<h2>Add New Product</h2>
<form class="new-product-form" (ngSubmit)="onSubmit(productForm)" #productForm="ngForm" novalidate>
  <div class="form-group">
    <label for="name">Product Name:</label>
    <input id="name" name="name" [(ngModel)]="product.name" required minlength="3" #name="ngModel"
           [ngClass]="{ 'is-invalid': productForm.submitted && name.invalid }">
    <div *ngIf="productForm.submitted && name.invalid" class="invalid-feedback">
      <span *ngIf="name.errors?.['required']">Product name is required.</span>
      <span *ngIf="name.errors?.['minlength']">Product name must be at least 3 characters.</span>
    </div>
  </div>

  <div class="form-group">
    <label for="price">Price:</label>
    <input id="price" name="price" type="number" [(ngModel)]="product.price" required min="0.01" #price="ngModel"
           [ngClass]="{ 'is-invalid': productForm.submitted && price.invalid }">
    <div *ngIf="productForm.submitted && price.invalid" class="invalid-feedback">
      <span *ngIf="price.errors?.['required']">Price is required.</span>
      <span *ngIf="price.errors?.['min']">Price must be positive.</span>
    </div>
  </div>

  <div class="form-group">
    <label for="stockQuantity">Stock:</label>
    <input id="stockQuantity" name="stockQuantity" type="number" [(ngModel)]="product.stockQuantity" required min="0" #stockQuantity="ngModel"
           [ngClass]="{ 'is-invalid': productForm.submitted && stockQuantity.invalid }">
    <div *ngIf="productForm.submitted && stockQuantity.invalid" class="invalid-feedback">
      <span *ngIf="stockQuantity.errors?.['required']">Stock quantity is required.</span>
      <span *ngIf="stockQuantity.errors?.['min']">Stock quantity cannot be negative.</span>
    </div>
  </div>

  <div class="form-group">
    <label for="categoryId">Category:</label>
    <select id="categoryId" name="categoryId" [(ngModel)]="product.categoryId" required #categoryId="ngModel"
            [ngClass]="{ 'is-invalid': productForm.submitted && categoryId.invalid }">
      <option [ngValue]="null" disabled>Select a category</option>
      <option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</option>
    </select>
    <div *ngIf="productForm.submitted && categoryId.invalid" class="invalid-feedback">
      Category is required.
    </div>
  </div>

  <div class="form-group">
    <label for="description">Description:</label>
    <textarea id="description" name="description" [(ngModel)]="product.description" rows="4"></textarea>
  </div>

  <div class="form-group">
    <label for="imageFile">Product Image:</label>
    <input id="imageFile" type="file" (change)="onFileSelected($event)" accept="image/*" />
  </div>

  <div *ngIf="imagePreview" class="image-preview-container">
    <label>Image Preview:</label><br />
    <img [src]="imagePreview" alt="Product Image Preview" class="image-preview" />
  </div>

  <div class="form-group form-check">
    <input type="checkbox" class="form-check-input" id="active" name="active" [(ngModel)]="product.active">
    <label class="form-check-label" for="active">Active</label>
  </div>

  <button type="submit" class="btn-submit" [disabled]="productForm.invalid && productForm.submitted">
    {{ product.id ? 'Update Product' : 'Add Product' }}
  </button>
  <div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>
</form>