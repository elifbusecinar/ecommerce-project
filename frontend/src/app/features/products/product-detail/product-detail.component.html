<div class="product-detail-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading product details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-state">
    <p>{{ error }}</p>
    <button (click)="reloadProduct()">Try Again</button>
  </div>

  <!-- Product Content -->
  <div *ngIf="!loading && !error && product" class="product-content">
    <!-- Product Main Section -->
    <div class="product-main">
      <!-- Product Images -->
      <div class="product-images">
        <div class="main-image">
          <img [src]="product.images?.[selectedImageIndex] || product.imageUrl" [alt]="product.name">
        </div>
        <div class="thumbnail-list">
          <div *ngFor="let image of product.images || []; let i = index"
               class="thumbnail"
               [class.active]="i === selectedImageIndex"
               (click)="selectImage(i)">
            <img [src]="image" [alt]="product.name + ' thumbnail ' + (i + 1)">
          </div>
        </div>
      </div>

      <!-- Product Info -->
      <div class="product-info">
        <h1>{{ product.name }}</h1>
        <div class="rating">
          <div class="stars">
            <span *ngFor="let star of getRatingStars(product.rating ?? 0)"
                  class="star"
                  [class.filled]="star === 1">★</span>
          </div>
          <span class="rating-value">{{ product.rating }}</span>
          <span class="review-count">({{ product.reviews?.length || 0 }} reviews)</span>
        </div>
        <div class="price">${{ product.price.toFixed(2) }}</div>
        <p class="description">{{ product.description }}</p>
        <div class="add-to-cart">
          <div class="quantity">
            <button (click)="decreaseQuantity()">-</button>
            <input type="number" [(ngModel)]="quantity" min="1" [max]="product.stock ?? 0">
            <button (click)="increaseQuantity()">+</button>
          </div>
          <button class="add-to-cart-btn"
                  [disabled]="(product.stock ?? 0) === 0"
                  (click)="addToCart()">
            {{ (product.stock ?? 0) === 0 ? 'Out of Stock' : 'Add to Cart' }}
          </button>
        </div>
        <p class="stock" [class.low-stock]="(product.stock ?? 0) <= 5">
          {{ (product.stock ?? 0) > 0 ? (product.stock ?? 0) + ' items in stock' : 'Out of stock' }}
        </p>
      </div>
    </div>

    <!-- Product Details Tabs -->
    <div class="product-details">
      <div class="tabs">
        <div class="tab active">Specifications</div>
      </div>
      <div class="specifications">
        <table>
          <tr *ngFor="let spec of product.specifications || []">
            <td class="spec-name">{{ spec.name }}</td>
            <td class="spec-value">{{ spec.value }}</td>
          </tr>
        </table>
      </div>
    </div>

    <!-- Reviews Section -->
    <div class="reviews">
      <div class="add-review">
        <h3>Write a Review</h3>
        <div class="rating-input">
          <span>Rating:</span>
          <div class="stars">
            <span *ngFor="let star of [1,2,3,4,5]"
                  class="star"
                  [class.filled]="star <= newReview.rating"
                  (click)="newReview.rating = star">★</span>
          </div>
        </div>
        <textarea [(ngModel)]="newReview.comment"
                  placeholder="Write your review here..."
                  [disabled]="submittingReview"></textarea>
        <button (click)="submitReview()"
                [disabled]="!newReview.comment.trim() || submittingReview">
          {{ submittingReview ? 'Submitting...' : 'Submit Review' }}
        </button>
      </div>

      <div class="review-list">
        <div *ngFor="let review of product.reviews || []" class="review">
          <div class="review-header">
            <span class="user">{{ review.user }}</span>
            <span class="date">{{ review.date | date }}</span>
          </div>
          <div class="stars">
            <span *ngFor="let star of getRatingStars(review.rating)"
                  class="star"
                  [class.filled]="star === 1">★</span>
          </div>
          <p class="comment">{{ review.comment }}</p>
        </div>
      </div>
    </div>

    <!-- Similar Products -->
    <div class="similar-products" *ngIf="similarProducts.length > 0">
      <h2>Similar Products</h2>
      <div class="product-grid">
        <div *ngFor="let similarProduct of similarProducts" class="product-card">
          <img [src]="similarProduct.images?.[0] || similarProduct.imageUrl" [alt]="similarProduct.name">
          <div class="product-info">
            <h3>{{ similarProduct.name }}</h3>
            <div class="price">${{ similarProduct.price.toFixed(2) }}</div>
            <button [routerLink]="['/products', similarProduct.id]">View Details</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>